!function(e){e.Jcrop=function(t,n){function o(e){return Math.round(e)+"px"}function r(e){return k.baseClass+"-"+e}function i(t){var n=e(t).offset();return[n.left,n.top]}function a(e){return[e.pageX-S[0],e.pageY-S[1]]}function s(t){"object"!=typeof t&&(t={}),k=e.extend(k,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof k[t]&&(k[t]=function(){})})}function c(e,t,n){if(S=i(I),oe.setCursor("move"===e?e:e+"-resize"),"move"===e)return oe.activateHandlers(function(e){var t=e;return re.watchKeys(),function(e){ee.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,ne.update()}}(t),f,n);var o=ee.getFixed(),r=u(e),a=ee.getCorner(u(r));ee.setPressed(ee.getCorner(r)),ee.setCurrent(a),oe.activateHandlers(function(e,t){return function(n){if(k.aspectRatio)switch(e){case"e":case"w":n[1]=t.y+1;break;case"n":case"s":n[0]=t.x+1}else switch(e){case"e":case"w":n[1]=t.y2;break;case"n":case"s":n[0]=t.x2}ee.setCurrent(n),ne.update()}}(e,o),f,n)}function u(e){switch(e){case"n":return"sw";case"s":case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function d(e){return function(t){return!k.disabled&&(!("move"===e&&!k.allowMove)&&(S=i(I),G=!0,c(e,a(t)),t.stopPropagation(),t.preventDefault(),!1))}}function l(e,t,n){var o=e.width(),r=e.height();o>t&&t>0&&(o=t,r=t/e.width()*e.height()),r>n&&n>0&&(r=n,o=n/e.height()*e.width()),L=e.width()/o,X=e.height()/r,e.width(o).height(r)}function h(e){return{x:e.x*L,y:e.y*X,x2:e.x2*L,y2:e.y2*X,w:e.w*L,h:e.h*X}}function f(e){var t=ee.getFixed();t.w>k.minSelect[0]&&t.h>k.minSelect[1]?(ne.enableHandles(),ne.done()):ne.release(),oe.setCursor(k.allowSelect?"crosshair":"default")}function p(e){if(k.disabled)return!1;if(!k.allowSelect)return!1;G=!0,S=i(I),ne.disableHandles(),oe.setCursor("crosshair");var t=a(e);return ee.setPressed(t),ne.update(),oe.activateHandlers(g,f,"touch"===e.type.substring(0,5)),re.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function g(e){ee.setCurrent(e),ne.update()}function b(){var t=e("<div></div>").addClass(r("tracker"));return M&&t.css({opacity:0,backgroundColor:"white"}),t}function w(e){v([e[0]/L,e[1]/X,e[2]/L,e[3]/X]),k.onSelect.call(ie,h(ee.getFixed())),ne.enableHandles()}function v(e){ee.setPressed([e[0],e[1]]),ee.setCurrent([e[2],e[3]]),ne.update()}function y(){k.disabled=!0,ne.disableHandles(),ne.setCursor("default"),oe.setCursor("default")}function m(){k.disabled=!1,x()}function C(t,n,o){var r=n||k.bgColor;k.bgFade&&e.fx.step.hasOwnProperty("backgroundColor")&&k.fadeTime&&!o?t.animate({backgroundColor:r},{queue:!1,duration:k.fadeTime}):t.css("backgroundColor",r)}function x(e){k.allowResize?e?ne.enableOnly():ne.enableHandles():ne.disableHandles(),oe.setCursor(k.allowSelect?"crosshair":"default"),ne.setCursor(k.allowMove?"move":"default"),k.hasOwnProperty("trueSize")&&(L=k.trueSize[0]/B,X=k.trueSize[1]/P),k.hasOwnProperty("setSelect")&&(w(k.setSelect),ne.done(),delete k.setSelect),te.refresh(),k.bgColor!=Z&&(C(k.shade?te.getShades():J,k.shade?k.shadeColor||k.bgColor:k.bgColor),Z=k.bgColor),$!=k.bgOpacity&&($=k.bgOpacity,k.shade?te.refresh():ne.setBgOpacity($)),E=k.maxSize[0]||0,W=k.maxSize[1]||0,Y=k.minSize[0]||0,q=k.minSize[1]||0,k.hasOwnProperty("outerImage")&&(I.attr("src",k.outerImage),delete k.outerImage),ne.refresh()}var S,k=e.extend({},e.Jcrop.defaults),z=navigator.userAgent.toLowerCase(),M=/msie/.test(z),O=/msie [1-6]\./.test(z);"object"!=typeof t&&(t=e(t)[0]),"object"!=typeof n&&(n={}),s(n);var j={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},F=e(t),H=!0;if("IMG"==t.tagName){if(0!=F[0].width&&0!=F[0].height)F.width(F[0].width),F.height(F[0].height);else{var D=new Image;D.src=F[0].src,F.width(D.width),F.height(D.height)}var I=F.clone().removeAttr("id").css(j).show();I.width(F.width()),I.height(F.height()),F.after(I).hide()}else I=F.css(j).show(),H=!1,null===k.shade&&(k.shade=!0);l(I,k.boxWidth,k.boxHeight);var B=I.width(),P=I.height(),J=e("<div />").width(B).height(P).addClass(r("holder")).css({position:"relative",backgroundColor:k.bgColor}).insertAfter(F).append(I);k.addClass&&J.addClass(k.addClass);var A=e("<div />"),R=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),T=e("<div />").width("100%").height("100%").css("zIndex",320),K=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=ee.getFixed();k.onDblClick.call(ie,e)}).insertBefore(I).append(R,T);H&&(A=e("<img />").attr("src",I.attr("src")).css(j).width(B).height(P),R.append(A)),O&&K.css({overflowY:"hidden"});var E,W,Y,q,L,X,G,N,V,Q=k.boundary,U=b().width(B+2*Q).height(P+2*Q).css({position:"absolute",top:o(-Q),left:o(-Q),zIndex:290}).mousedown(p),Z=k.bgColor,$=k.bgOpacity;S=i(I);var _=function(){function e(){var e,t={},n=["touchstart","touchmove","touchend"],o=document.createElement("div");try{for(e=0;e<n.length;e++){var r=n[e],i=(r="on"+r)in o;i||(o.setAttribute(r,"return;"),i="function"==typeof o[r]),t[n[e]]=i}return t.touchstart&&t.touchend&&t.touchmove}catch(e){return!1}}return{createDragger:function(e){return function(t){return!k.disabled&&(!("move"===e&&!k.allowMove)&&(S=i(I),G=!0,c(e,a(_.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1))}},newSelection:function(e){return p(_.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:!0===k.touchSupport||!1===k.touchSupport?k.touchSupport:e()}}(),ee=function(){function e(){if(!k.aspectRatio)return function(){var e,t=c-a,r=u-s;E&&Math.abs(t)>E&&(c=t>0?a+E:a-E);W&&Math.abs(r)>W&&(u=r>0?s+W:s-W);q/X&&Math.abs(r)<q/X&&(u=r>0?s+q/X:s-q/X);Y/L&&Math.abs(t)<Y/L&&(c=t>0?a+Y/L:a-Y/L);a<0&&(c-=a,a-=a);s<0&&(u-=s,s-=s);c<0&&(a-=c,c-=c);u<0&&(s-=u,u-=u);c>B&&(a-=e=c-B,c-=e);u>P&&(s-=e=u-P,u-=e);a>B&&(u-=e=a-P,s-=e);s>P&&(u-=e=s-P,s-=e);return o(n(a,s,c,u))}();var e,t,r,i,d=k.aspectRatio,l=k.minSize[0]/L,h=k.maxSize[0]/L,f=k.maxSize[1]/X,p=c-a,g=u-s,b=Math.abs(p),w=Math.abs(g);return 0===h&&(h=10*B),0===f&&(f=10*P),b/w<d?(t=u,r=w*d,(e=p<0?a-r:r+a)<0?(e=0,i=Math.abs((e-a)/d),t=g<0?s-i:i+s):e>B&&(e=B,i=Math.abs((e-a)/d),t=g<0?s-i:i+s)):(e=c,i=b/d,(t=g<0?s-i:s+i)<0?(t=0,r=Math.abs((t-s)*d),e=p<0?a-r:r+a):t>P&&(t=P,r=Math.abs(t-s)*d,e=p<0?a-r:r+a)),e>a?(e-a<l?e=a+l:e-a>h&&(e=a+h),t=t>s?s+(e-a)/d:s-(e-a)/d):e<a&&(a-e<l?e=a-l:a-e>h&&(e=a-h),t=t>s?s+(a-e)/d:s-(a-e)/d),e<0?(a-=e,e=0):e>B&&(a-=e-B,e=B),t<0?(s-=t,t=0):t>P&&(s-=t-P,t=P),o(n(a,s,e,t))}function t(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>B&&(e[0]=B),e[1]>P&&(e[1]=P),[Math.round(e[0]),Math.round(e[1])]}function n(e,t,n,o){var r=e,i=n,a=t,s=o;return n<e&&(r=n,i=e),o<t&&(a=o,s=t),[r,a,i,s]}function o(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var r,i,a=0,s=0,c=0,u=0;return{flipCoords:n,setPressed:function(e){e=t(e),c=a=e[0],u=s=e[1]},setCurrent:function(e){e=t(e),r=e[0]-c,i=e[1]-u,c=e[0],u=e[1]},getOffset:function(){return[r,i]},moveOffset:function(e){var t=e[0],n=e[1];0>a+t&&(t-=t+a),0>s+n&&(n-=n+s),P<u+n&&(n+=P-(u+n)),B<c+t&&(t+=B-(c+t)),a+=t,c+=t,s+=n,u+=n},getCorner:function(t){var n=e();switch(t){case"ne":return[n.x2,n.y];case"nw":return[n.x,n.y];case"se":return[n.x2,n.y2];case"sw":return[n.x,n.y2]}},getFixed:e}}(),te=function(){function t(){return n(ee.getFixed())}function n(e){h.top.css({left:o(e.x),width:o(e.w),height:o(e.y)}),h.bottom.css({top:o(e.y2),left:o(e.x),width:o(e.w),height:o(P-e.y2)}),h.right.css({left:o(e.x2),width:o(B-e.x2)}),h.left.css({width:o(e.x)})}function r(){return e("<div />").css({position:"absolute",backgroundColor:k.shadeColor||k.bgColor}).appendTo(l)}function i(){d||(d=!0,l.insertBefore(I),t(),ne.setBgOpacity(1,0,1),A.hide(),a(k.shadeColor||k.bgColor,1),ne.isAwake()?c(k.bgOpacity,1):c(1,1))}function a(e,t){C(u(),e,t)}function s(){d&&(l.remove(),A.show(),d=!1,ne.isAwake()?ne.setBgOpacity(k.bgOpacity,1,1):(ne.setBgOpacity(1,1,1),ne.disableHandles()),C(J,0,1))}function c(e,t){d&&(k.bgFade&&!t?l.animate({opacity:1-e},{queue:!1,duration:k.fadeTime}):l.css({opacity:1-e}))}function u(){return l.children()}var d=!1,l=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),h={top:r(),left:r().height(P),right:r().height(P),bottom:r()};return{update:t,updateRaw:n,getShades:u,setBgColor:a,enable:i,disable:s,resize:function(e,t){h.left.css({height:o(t)}),h.right.css({height:o(t)})},refresh:function(){k.shade?i():s(),ne.isAwake()&&c(k.bgOpacity)},opacity:c}}(),ne=function(){function t(t){var n=e("<div />").css({position:"absolute",opacity:k.borderOpacity}).addClass(r(t));return R.append(n),n}function n(t,n){var o=e("<div />").mousedown(d(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+t);return _.support&&o.bind("touchstart.jcrop",_.createDragger(t)),T.append(o),o}function i(e){var t=k.handleSize,o=n(e,v++).css({opacity:k.handleOpacity}).addClass(r("handle"));return t&&o.width(t).height(t),o}function a(e){return n(e,v++).addClass("jcrop-dragbar")}function s(){var e=ee.getFixed();ee.setPressed([e.x,e.y]),ee.setCurrent([e.x2,e.y2]),c()}function c(e){if(w)return u(e)}function u(e){var t=ee.getFixed();!function(e,t){K.width(Math.round(e)).height(Math.round(t))}(t.w,t.h),function(e,t){k.shade||A.css({top:o(-t),left:o(-e)}),K.css({top:o(t),left:o(e)})}(t.x,t.y),k.shade&&te.updateRaw(t),w||function(){K.show(),k.shade?te.opacity($):l($,!0);w=!0}(),e?k.onSelect.call(ie,h(t)):k.onChange.call(ie,h(t))}function l(e,t,n){(w||t)&&(k.bgFade&&!n?I.animate({opacity:e},{queue:!1,duration:k.fadeTime}):I.css("opacity",e))}function f(){if(x=!0,k.allowResize)return T.show(),!0}function p(){x=!1,T.hide()}function g(e){e?(N=!0,p()):(N=!1,f())}var w,v=370,y={},m={},C={},x=!1;k.dragEdges&&e.isArray(k.createDragbars)&&function(e){var t;for(t=0;t<e.length;t++)C[e[t]]=a(e[t])}(k.createDragbars),e.isArray(k.createHandles)&&function(e){var t;for(t=0;t<e.length;t++)m[e[t]]=i(e[t])}(k.createHandles),k.drawBorders&&e.isArray(k.createBorders)&&function(e){var n,o;for(o=0;o<e.length;o++){switch(e[o]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}y[e[o]]=t(n)}}(k.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()});var S=b().mousedown(d("move")).css({cursor:"move",position:"absolute",zIndex:360});return _.support&&S.bind("touchstart.jcrop",_.createDragger("move")),R.append(S),p(),{updateVisible:c,update:u,release:function(){p(),K.hide(),k.shade?te.opacity(1):l(1),w=!1,k.onRelease.call(ie)},refresh:s,isAwake:function(){return w},setCursor:function(e){S.css("cursor",e)},enableHandles:f,enableOnly:function(){x=!0},showHandles:function(){x&&T.show()},disableHandles:p,animMode:g,setBgOpacity:l,done:function(){g(!1),s()}}}(),oe=function(){function t(e){return i(a(e)),!1}function n(t){return t.preventDefault(),t.stopPropagation(),G&&(G=!1,s(a(t)),ne.isAwake()&&k.onSelect.call(ie,h(ee.getFixed())),U.css({zIndex:290}),e(document).unbind(".jcrop"),i=function(){},s=function(){}),!1}function o(e){return i(a(_.cfilter(e))),!1}function r(e){return n(_.cfilter(e))}var i=function(){},s=function(){},c=k.trackDocument;return c||U.mousemove(t).mouseup(n).mouseout(n),I.before(U),{activateHandlers:function(a,u,d){return G=!0,i=a,s=u,function(i){U.css({zIndex:450}),i?e(document).bind("touchmove.jcrop",o).bind("touchend.jcrop",r):c&&e(document).bind("mousemove.jcrop",t).bind("mouseup.jcrop",n)}(d),!1},setCursor:function(e){U.css("cursor",e)}}}(),re=function(){function t(e,t,n){k.allowMove&&(ee.moveOffset([t,n]),ne.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}var n=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),o=e("<div />").css({position:"absolute",overflow:"hidden"}).append(n);return k.keySupport&&(n.keydown(function(e){if(e.ctrlKey||e.metaKey)return!0;var n=(V=!!e.shiftKey)?10:1;switch(e.keyCode){case 37:t(e,-n,0);break;case 39:t(e,n,0);break;case 38:t(e,0,-n);break;case 40:t(e,0,n);break;case 27:k.allowSelect&&ne.release();break;case 9:return!0}return!1}).blur(function(e){n.hide()}),O||!k.fixedSupport?(n.css({position:"absolute",left:"-20px"}),o.append(n).insertBefore(I)):n.insertBefore(I)),{watchKeys:function(){k.keySupport&&(n.show(),n.focus())}}}();_.support&&U.bind("touchstart.jcrop",_.newSelection),T.hide(),x(!0);var ie={setImage:function(e,t){ne.release(),y();var n=new Image;n.onload=function(){var o=n.width,r=n.height,i=k.boxWidth,a=k.boxHeight;I.width(o).height(r),I.attr("src",e),A.attr("src",e),l(I,i,a),B=I.width(),P=I.height(),A.width(B).height(P),U.width(B+2*Q).height(P+2*Q),J.width(B).height(P),te.resize(B,P),m(),"function"==typeof t&&t.call(ie)},n.src=e},animateTo:function(e,t){function n(){window.setTimeout(y,l)}var o=e[0]/L,r=e[1]/X,i=e[2]/L,a=e[3]/X;if(!N){var s=ee.flipCoords(o,r,i,a),c=ee.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=k.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],b=0,w=k.swingSpeed;o=d[0],r=d[1],i=d[2],a=d[3],ne.animMode(!0);var y=function(){b+=(100-b)/w,d[0]=Math.round(o+b/100*h),d[1]=Math.round(r+b/100*f),d[2]=Math.round(i+b/100*p),d[3]=Math.round(a+b/100*g),b>=99.8&&(b=100),b<100?(v(d),n()):(ne.done(),ne.animMode(!1),"function"==typeof t&&t.call(ie))};n()}},setSelect:w,setOptions:function(e){s(e),x()},tellSelect:function(){return h(ee.getFixed())},tellScaled:function(){return ee.getFixed()},setClass:function(e){J.removeClass().addClass(r("holder")).addClass(e)},disable:y,enable:m,cancel:function(){ne.done(),oe.activateHandlers(null,null)},release:ne.release,destroy:function(){J.remove(),F.show(),F.css("visibility","visible"),e(t).removeData("Jcrop")},focus:re.watchKeys,getBounds:function(){return[B*L,P*X]},getWidgetSize:function(){return[B,P]},getScaleFactor:function(){return[L,X]},getOptions:function(){return k},ui:{holder:J,selection:K}};return M&&J.bind("selectstart",function(){return!1}),F.data("Jcrop",ie),ie},e.fn.Jcrop=function(t,n){var o;return this.each(function(){if(e(this).data("Jcrop")){if("api"===t)return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else"IMG"==this.tagName?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),o=e.Jcrop(this,t),e.isFunction(n)&&n.call(o)}):(e(this).css({display:"block",visibility:"hidden"}),o=e.Jcrop(this,t),e.isFunction(n)&&n.call(o))}),this},e.Jcrop.Loader=function(t,n,o){function r(){a.complete?(i.unbind(".jcloader"),e.isFunction(n)&&n.call(a)):window.setTimeout(r,50)}var i=e(t),a=i[0];i.bind("load.jcloader",r).bind("error.jcloader",function(t){i.unbind(".jcloader"),e.isFunction(o)&&o.call(a)}),a.complete&&e.isFunction(n)&&(i.unbind(".jcloader"),n.call(a))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);